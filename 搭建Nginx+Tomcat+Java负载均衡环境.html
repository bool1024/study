<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<link rel="stylesheet" type="text/css" href="file:///${exe}/scripts/highlight.styles/${SyntaxHighlightStyleName}.css" />
		<style>
			body, table{font-family: 微软雅黑}
			
			table{border-collapse: collapse; border: 1px solid gray; border-width: 2px 1px 2px 1px;}
			th{border: 1px solid gray; padding: 4px; background-color: #ddd;}
			td{border: 1px solid gray; padding: 4px;}
			tr:nth-child(2n){background-color: #f8f8f8;}
			pre{border: 2px solid #d6d6d6; padding: 0px; border-radius: 3px;}
		</style>
	</head>
	<body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">
		<div>1.修改tomcat-1的端口号为8082，修改tomcat-2的端口号为8083，然后配置nginx的nginx.conf，配置如下：
		</div>
		<div>
			<pre>
<code id="ID_162F01777C0" class="no-highlight"><ol><li>#user  nobody;</li><li>worker_processes  1;#工作进程的个数，可以配置多个</li><li></li><li>#error_log  logs/error.log;</li><li>#error_log  logs/error.log  notice;</li><li>#error_log  logs/error.log  info;</li><li></li><li>#pid        logs/nginx.pid;</li><li></li><li></li><li>events {</li><li>    worker_connections  1024;#单个进程最大连接数（最大连接数=连接数*进程数）</li><li>}</li><li></li><li>http {</li><li>    include       mime.types; #文件扩展名与文件类型映射表</li><li>    default_type  application/octet-stream;#默认文件类型</li><li></li><li>    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</li><li>    #                  '$status $body_bytes_sent "$http_referer" '</li><li>    #                  '"$http_user_agent" "$http_x_forwarded_for"';</li><li></li><li>    #access_log  logs/access.log  main;</li><li></li><li>    sendfile        on;#开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</li><li>    #tcp_nopush     on;</li><li></li><li>    #keepalive_timeout  0;</li><li>    keepalive_timeout  65; #长连接超时时间，单位是秒</li><li></li><li>    gzip  on;#启用Gizp压缩</li><li>	</li><li>	#服务器的集群</li><li>    upstream  quwenzhe {  #服务器集群名字</li><li>  		#server   172.16.21.13:8081 weight=1;#服务器配置   weight是权重的意思，权重越大，分配的概率越大。</li><li>		#server   192.168.1.186:8081 weight=1;</li><li>		#server   172.16.1.14:8081 weight=2;</li><li>		#server   172.16.1.15:8081 weight=1;</li><li>		#server   172.16.1.15:80 weight=1;		</li><li>		server    127.0.0.1:8082  weight=1;</li><li>		server    127.0.0.1:8083  weight=1;</li><li>	}	</li><li></li><li>	#当前的Nginx的配置</li><li>    server {</li><li>        listen       8081;#监听80端口，可以改成其他端口</li><li>        server_name  quwenzhe;##############	当前服务的域名       </li><li></li><li>        location / {</li><li>            index  index.html index.jsp;    </li><li>            proxy_pass  http://quwenzhe;    </li><li>            proxy_set_header    X-Real-IP   $remote_addr;    </li><li>            client_max_body_size    100m; </li><li>        }</li><li>		</li><li>        error_page   500 502 503 504  /50x.html;</li><li>        location = /50x.html {</li><li>            root   html;</li><li>        }      </li><li>    }</li><li>}</li></ol></code></pre>
			<div>注：server_name名称必须和upstream名称一致，proxy_pass名称为http://server_name。upstream配置的是tomcat服务器列表，weight是权重的意思，权重越大，分配的概率越大。
			</div>
		</div>
		<div><br />
		</div>
		<div>2.创建一个简单的java web项目nginx01，在哪项目中创建一个index.js页面，在页面中添加内容“第一个测试页面”，将其部署到tomcat-1；将index.jsp页面中的内容改为“第二个测试页面”，将其部署到tomcat-2；启动tomcat-1，启动tomcat-2，用命令行切换到nginx服务器的目录，输入start nginx启动nginx服务器。
		</div>
		<div><br />
		</div>
		<div>3.在浏览器输入http://localhost:8082/nginx01/index.jsp，tomcat-1可以正常访问；输入http://localhost:8083/nginx01/index.jsp，tomcat-2可以正常访问；输入http://localhost:8081/nginx01/index.jsp，通过不断刷新页面，我们可以发现内容时而为“第一个测试页面”，时而为“第二个测试页面”，证明nginx成功实现请求的负载均衡。
		</div>
		<div><br />
		</div>
		<div><br />
		</div>
		<div>问题：当把tomcat服务器其中的一个关掉后，再起访问nginx服务器，发现服务器响应速速很慢，暂时没有找到解决方案。
		</div>
	</body>
</html>
