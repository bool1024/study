<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<link rel="stylesheet" type="text/css" href="file:///${exe}/scripts/highlight.styles/${SyntaxHighlightStyleName}.css" />
		<style>
			table{border-collapse: collapse; border: 1px solid gray; border-width: 2px 1px 2px 1px;}
			th{border: 1px solid gray; padding: 4px; background-color: #ddd;}
			td{border: 1px solid gray; padding: 4px;}
			tr:nth-child(2n){background-color: #f8f8f8;}
			pre{border: 2px solid #d6d6d6; padding: 0px; border-radius: 3px;}
		</style>
	</head>
	<body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">
		<div><span style="font-family: 微软雅黑">java.util.Arrays这个类提供了操作数组（比如排序和搜索）的各种方法，其中就有一个asList方法，可以直接把数组转化为List&lt;T&gt;形式的对象，下面看看这个asList方法</span>
		</div>
		<div><span style="font-family: 微软雅黑"><br /></span>
		</div>
		<div><span style="font-family: 微软雅黑">API描述如下</span>
		</div>
		<div>
			<pre>
<code id="ID_16367B073E8" class="no-highlight">@SafeVarargs
public static &lt;T&gt; List&lt;T&gt; asList(T... a)

        Returns a fixed-size list backed by the specified array. (Changes to the returned list "write through" to the array.) This method acts as bridge between 
        array-based and collection-based APIs, in combination with Collection.toArray(). The returned list is serializable and implements RandomAccess. 
        
        This method also provides a convenient way to create a fixed-size list initialized to contain several elements: 
                List&lt;String&gt; stooges = Arrays.asList("Larry", "Moe", "Curly");
 
        <b>Type Parameters</b>:
                T - the class of the objects in the array
        <b>Parameters</b>:
                a - the array by which the list will be backed
        <b>Returns</b>:
                <font class="Apple-style-span" color="#ff0000">a list view of the specified array</font></code></pre>
			<div><span style="font-family: 微软雅黑">可以看到，返回值就是一个List&lt;T&gt;，入参是一个T...。很多人看到这个方法说明后，再检查下入参和返回值，觉得合适就直接调用，没有想太多或者进一步研究这其中有没有问题。<span style="color: #ff0000">实际上，返回的List&lt;T&gt;真的是你想要的List&lt;T&gt;吗</span>？</span>
			</div>
			<div><span style="font-family: 微软雅黑"><br /></span>
			</div>
			<div><span style="font-family: 微软雅黑">List只是一个接口，看看JDK源码里面，这个方法返回的到底是什么类型的对象。</span>
			</div>
			<div>
				<pre>
<code id="ID_16367B43E71" class="lang-java hljs"><ol><li><span class="hljs-comment">/**</span></li><li> * Returns a fixed-size list backed by the specified array.  (Changes to</li><li> * the returned list "write through" to the array.)  This method acts</li><li> * as bridge between array-based and collection-based APIs, in</li><li> * combination with {<span class="hljs-doctag">@link</span> Collection#toArray}.  The returned list is</li><li> * serializable and implements {<span class="hljs-doctag">@link</span> RandomAccess}.</li><li> *</li><li> * &lt;p&gt;This method also provides a convenient way to create a fixed-size</li><li> * list initialized to contain several elements:</li><li> * &lt;pre&gt;</li><li> *     List&amp;lt;String&amp;gt; stooges = Arrays.asList("Larry", "Moe", "Curly");</li><li> * &lt;/pre&gt;</li><li> *</li><li> * <span class="hljs-doctag">@param</span> &lt;T&gt; the class of the objects in the array</li><li> * <span class="hljs-doctag">@param</span> a the array by which the list will be backed</li><li> * <span class="hljs-doctag">@return</span> a list view of the specified array</li><li> */</li><li><span class="hljs-meta">@SafeVarargs</span></li><li><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"varargs"</span>)</li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">asList</span><span class="hljs-params">(T... a)</span> </span>{</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(a);</li><li>}</li></ol></code></pre>
				<div><span style="font-family: 微软雅黑">这边是直接返回了一个new ArrayList，<span style="color: #ff0000">但是，这个ArrayList可不是java.util.ArrayList，而是java.util.Arrays.ArrayList，这是一个Arrays里内嵌的一个私有静态类，很容易混淆</span>。java.util.Arrays.ArrayList（就是转换出来的List）继承了java.util.AbstractList这个抽象类，<span style="color: #ff0000">是一个固定大小的List，不可变长的List</span>。继续查看java.uitl.AbstractList类，可以发现它的set、add、remove操作全部都是直接抛出了UnsupporttedOperationException异常</span>
				</div>
				<div><span style="font-family: 微软雅黑">
					<pre>
<code id="ID_16367BE8407" class="lang-java hljs"><ol><li><span class="hljs-comment">/**</span></li><li> * {<span class="hljs-doctag">@inheritDoc</span>}</li><li> *</li><li> * &lt;p&gt;This implementation always throws an</li><li> * {<span class="hljs-doctag">@code</span> UnsupportedOperationException}.</li><li> *</li><li> * <span class="hljs-doctag">@throws</span> UnsupportedOperationException {<span class="hljs-doctag">@inheritDoc</span>}</li><li> * <span class="hljs-doctag">@throws</span> ClassCastException            {<span class="hljs-doctag">@inheritDoc</span>}</li><li> * <span class="hljs-doctag">@throws</span> NullPointerException          {<span class="hljs-doctag">@inheritDoc</span>}</li><li> * <span class="hljs-doctag">@throws</span> IllegalArgumentException      {<span class="hljs-doctag">@inheritDoc</span>}</li><li> * <span class="hljs-doctag">@throws</span> IndexOutOfBoundsException     {<span class="hljs-doctag">@inheritDoc</span>}</li><li> */</li><li><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, E element)</span> </span>{</li><li>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException();</li><li>}</li><li></li><li><span class="hljs-comment">/**</span></li><li> * {<span class="hljs-doctag">@inheritDoc</span>}</li><li> *</li><li> * &lt;p&gt;This implementation always throws an</li><li> * {<span class="hljs-doctag">@code</span> UnsupportedOperationException}.</li><li> *</li><li> * <span class="hljs-doctag">@throws</span> UnsupportedOperationException {<span class="hljs-doctag">@inheritDoc</span>}</li><li> * <span class="hljs-doctag">@throws</span> ClassCastException            {<span class="hljs-doctag">@inheritDoc</span>}</li><li> * <span class="hljs-doctag">@throws</span> NullPointerException          {<span class="hljs-doctag">@inheritDoc</span>}</li><li> * <span class="hljs-doctag">@throws</span> IllegalArgumentException      {<span class="hljs-doctag">@inheritDoc</span>}</li><li> * <span class="hljs-doctag">@throws</span> IndexOutOfBoundsException     {<span class="hljs-doctag">@inheritDoc</span>}</li><li> */</li><li><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, E element)</span> </span>{</li><li>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException();</li><li>}</li><li></li><li><span class="hljs-comment">/**</span></li><li> * {<span class="hljs-doctag">@inheritDoc</span>}</li><li> *</li><li> * &lt;p&gt;This implementation always throws an</li><li> * {<span class="hljs-doctag">@code</span> UnsupportedOperationException}.</li><li> *</li><li> * <span class="hljs-doctag">@throws</span> UnsupportedOperationException {<span class="hljs-doctag">@inheritDoc</span>}</li><li> * <span class="hljs-doctag">@throws</span> IndexOutOfBoundsException     {<span class="hljs-doctag">@inheritDoc</span>}</li><li> */</li><li><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>{</li><li>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException();</li><li>}</li></ol></code></pre>
					<div>这个异常是运行时异常，所以在获取到这个“假的”ArrayList之后，对这个List中的内容做修改的话，无论是在Eclipse里面，还是在进行编译打包的时候，都不会有任何提示或者告警的。
					</div>
					<div><br />
					</div>
					<div><span style="color: #ff0000">总的来说，java.util.Arrays.ArrayList其实只是对数据做了一个装饰，可以看到里面的实现都是对数组的访问，它的目的只是提供了可以像访问List那样来访问数组而已。本质上其实还是一个数组，并不是一个标准的List。所以除非确定获取后的List只涉及到读取操作，否则的话强烈建议不要直接使用Arrays.asList(T...a)方法获取List</span>。用下面的方法可以转换为真实的List
					</div></span>
				</div>
				<div><span style="font-family: 微软雅黑">
					<pre>
<code id="ID_16367C4DACF" class="lang-java hljs"><ol><li>String[] strs = {<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"c"</span>};</li><li>List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;(strs.length);</li><li><span class="hljs-keyword">for</span>(String str: strs){</li><li>    list.add(str);</li><li>}</li></ol></code></pre>
					<div>或者利用java.util.ArrayList的构造函数将返回的java.util.Arrays.ArrayList对象包一层，来转换为真正的java.util.ArrayList对象：
					</div>
					<div>
						<pre>
<code id="ID_16367CD2D82" class="lang-java hljs"><ol><li>String[] strs = {<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"c"</span>};</li><li>List&lt;String&gt; tempList = Arrays.asList(strs);</li><li>List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;(tempList);</li></ol></code></pre>
						<div><br />
						</div>
					</div></span>
				</div>
			</div>
		</div>
	</body>
</html>
