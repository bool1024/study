<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<link rel="stylesheet" type="text/css" href="file:///${exe}/scripts/highlight.styles/${SyntaxHighlightStyleName}.css" />
		<style>
			body, table{font-family: 微软雅黑}
			
			table{border-collapse: collapse; border: 1px solid gray; border-width: 2px 1px 2px 1px;}
			th{border: 1px solid gray; padding: 4px; background-color: #ddd;}
			td{border: 1px solid gray; padding: 4px;}
			tr:nth-child(2n){background-color: #f8f8f8;}
			pre{border: 2px solid #d6d6d6; padding: 0px; border-radius: 3px;}
		</style>
	</head>
	<body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">
		<div>1.web根目录（webapp/WebContent）下创建web目录，用于放置我们的extjs desktop整体项目文件
		</div>
		<div><br />
		</div>
		<div>2.web目录下创建extjs目录，将所需的extjs库文件放入该目录
		</div>
		<div><br />
		</div>
		<div>3.web目录下创建desktop目录，将extjs官方例子中的desktop拷贝过来，只保留css、images、js和wallpapers目录以及Settings.js文件，其他文件都删除
		</div>
		<div><br />
		</div>
		<div>4.打开web/desktop/js/App.js文件，找到init方法中的如下代码
		</div>
		<div>
			<pre>
<code id="ID_162DCF01C49" class="lang-javascript hljs"><ol><li>desktopCfg = me.getDesktopConfig();</li><li>me.desktop = <span class="hljs-keyword">new</span> Ext.ux.desktop.Desktop(desktopCfg);</li></ol></code></pre>
			<div>&nbsp;在两句话之间添加如下代码：
			</div>
		</div>
		<div>
			<pre>
<code id="ID_162DCF28B86" class="lang-javascript hljs"><ol><li><span class="hljs-keyword">var</span> items=desktopCfg.shortcuts.data.items;</li><li><span class="hljs-keyword">var</span> menus=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();</li><li>Ext.each(items,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>)</span>{</li><li>        <span class="hljs-keyword">var</span> obj={};</li><li>        <span class="hljs-comment">//设定图标名称</span></li><li>        obj.text=item.data.name;</li><li>        <span class="hljs-comment">//设定图标的样式，这个是我们自定义的 任务栏显示按钮数据</span></li><li>        obj.iconCls=item.data.viewIconCls,</li><li>        <span class="hljs-comment">//点击的时候，调用desktop的图标点击事件</span></li><li>        obj.handler=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</li><li>                me.desktop.onShortcutItemClick(<span class="hljs-literal">null</span>,item);</li><li>        } </li><li>        <span class="hljs-comment">//添加对象</span></li><li>        menus.push(obj);</li><li>});</li><li><span class="hljs-comment">//修改开始任务栏</span></li><li>desktopCfg.taskbarConfig.startConfig.menu=menus;</li></ol></code></pre>
			<div>完整的init函数如下：
			</div>
		</div>
		<div>
			<pre>
<code id="ID_162DCF6B8C1" class="lang-javascript hljs"><ol><li>init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, desktopCfg;</li><li></li><li>    <span class="hljs-keyword">if</span> (me.useQuickTips) {</li><li>        Ext.QuickTips.init();</li><li>    }</li><li></li><li>    me.modules = me.getModules();</li><li>    <span class="hljs-keyword">if</span> (me.modules) {</li><li>        me.initModules(me.modules);</li><li>    }</li><li></li><li>    desktopCfg = me.getDesktopConfig();</li><li>    <span class="hljs-keyword">var</span> items=desktopCfg.shortcuts.data.items;</li><li>    <span class="hljs-keyword">var</span> menus=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();</li><li>    Ext.each(items,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>)</span>{</li><li>        <span class="hljs-keyword">var</span> obj={};</li><li>        <span class="hljs-comment">//设定图标名称</span></li><li>        obj.text=item.data.name;</li><li>        <span class="hljs-comment">//设定图标的样式，这个是我们自定义的 任务栏显示按钮数据</span></li><li>        obj.iconCls=item.data.viewIconCls,</li><li>        <span class="hljs-comment">//点击的时候，调用desktop的图标点击事件</span></li><li>        obj.handler=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</li><li>            me.desktop.onShortcutItemClick(<span class="hljs-literal">null</span>,item);</li><li>        } </li><li>        <span class="hljs-comment">//添加对象</span></li><li>        menus.push(obj);</li><li>    });</li><li>    <span class="hljs-comment">//修改开始任务栏</span></li><li>    desktopCfg.taskbarConfig.startConfig.menu=menus;</li><li>    me.desktop = <span class="hljs-keyword">new</span> Ext.ux.desktop.Desktop(desktopCfg);</li><li></li><li>    me.viewport = <span class="hljs-keyword">new</span> Ext.container.Viewport({</li><li>        <span class="hljs-attr">layout</span>: <span class="hljs-string">'fit'</span>,</li><li>        <span class="hljs-attr">items</span>: [ me.desktop ]</li><li>    });</li><li></li><li>    Ext.EventManager.on(<span class="hljs-built_in">window</span>, <span class="hljs-string">'beforeunload'</span>, me.onUnload, me);</li><li></li><li>    me.isReady = <span class="hljs-literal">true</span>;</li><li>    me.fireEvent(<span class="hljs-string">'ready'</span>, me);</li><li>}</li></ol></code></pre>
			<div><br />
			</div>
		</div>
		<div>5.打开web/desktop/js/Desktop.js文件，找到onShortcutItemClick方法，将其内容修改为：
		</div>
		<div>
			<pre>
<code id="ID_162DCFABD44" class="lang-javascript hljs"><ol><li>onShortcutItemClick: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dataView, record</span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>;</li><li>    <span class="hljs-keyword">var</span> win = <span class="hljs-literal">null</span>;</li><li>    win = Ext.getCmp(record.data.module);</li><li>    <span class="hljs-keyword">if</span> (!win) {</li><li>      <span class="hljs-comment">// 互获取属性里面的控制器</span></li><li>      <span class="hljs-comment">/*var controller = coreApp.getController(record.data.controller);</span></li><li>      // 实例化控制器</li><li>      if (!controller.inited) {</li><li>        controller.init();</li><li>        controller.inited = true;</li><li>      }*/</li><li>      win = me.createWindow({</li><li>        <span class="hljs-comment">// 窗口的名称和桌面图标名一样</span></li><li>        title: record.data.name,</li><li>        <span class="hljs-comment">// 获取静态变量</span></li><li>        width: comm.get(<span class="hljs-string">"resolutionWidth"</span>) * <span class="hljs-number">0.6</span>,</li><li>        <span class="hljs-attr">height</span>: comm.get(<span class="hljs-string">"resolutionHeight"</span>) * <span class="hljs-number">0.6</span>,</li><li>        <span class="hljs-comment">// 窗口图标</span></li><li>        iconCls: record.data.viewIconCls,</li><li>        <span class="hljs-comment">// 窗口的id 就是我们的模块名称</span></li><li>        id: record.data.module,</li><li>        <span class="hljs-attr">border</span>: <span class="hljs-literal">false</span>,</li><li>        <span class="hljs-attr">hideMode</span>: <span class="hljs-string">'offsets'</span>,</li><li>        <span class="hljs-comment">// 可以关闭</span></li><li>        closable: <span class="hljs-literal">true</span>,</li><li>        <span class="hljs-comment">// 隐藏</span></li><li>        closeAction: <span class="hljs-string">"hide"</span>,</li><li>        <span class="hljs-attr">layout</span>: <span class="hljs-string">"fit"</span>,</li><li>        <span class="hljs-attr">items</span>: {</li><li>          <span class="hljs-attr">xtype</span>: record.data.module + <span class="hljs-string">'-main-view'</span></li><li>        }</li><li>      });</li><li>    }</li><li>    <span class="hljs-comment">// 如果是窗口， 直接显示</span></li><li>    <span class="hljs-comment">// 就是最小化后直接显示数据</span></li><li>    <span class="hljs-keyword">if</span> (win) {</li><li>      me.restoreWindow(win);</li><li>    }</li><li>  }</li></ol></code></pre>
			<div><br />
			</div>
		</div>
		<div>6.修改Desktop中的一些英文显示，将其均修改为中文，完整的Desktop.js代码如下：
		</div>
		<div>
			<pre>
<code id="ID_162DCFBE98B" class="lang-javascript hljs"><ol><li>Ext.define(<span class="hljs-string">'Ext.ux.desktop.Desktop'</span>,{</li><li>  <span class="hljs-attr">extend</span>: <span class="hljs-string">'Ext.panel.Panel'</span>,</li><li>  <span class="hljs-attr">alias</span>: <span class="hljs-string">'widget.desktop'</span>,</li><li>  <span class="hljs-attr">uses</span>: [<span class="hljs-string">'Ext.util.MixedCollection'</span>, <span class="hljs-string">'Ext.menu.Menu'</span>,<span class="hljs-string">'Ext.view.View'</span>, <span class="hljs-string">'Ext.window.Window'</span>,<span class="hljs-string">'Ext.ux.desktop.TaskBar'</span>,<span class="hljs-string">'Ext.ux.desktop.Wallpaper'</span> ],</li><li></li><li>  <span class="hljs-attr">activeWindowCls</span>: <span class="hljs-string">'ux-desktop-active-win'</span>,</li><li>  <span class="hljs-attr">inactiveWindowCls</span>: <span class="hljs-string">'ux-desktop-inactive-win'</span>,</li><li>  <span class="hljs-attr">lastActiveWindow</span>: <span class="hljs-literal">null</span>,</li><li></li><li>  <span class="hljs-attr">border</span>: <span class="hljs-literal">false</span>,</li><li>  <span class="hljs-attr">html</span>: <span class="hljs-string">'&amp;#160;'</span>,</li><li>  <span class="hljs-attr">layout</span>: <span class="hljs-string">'fit'</span>,</li><li></li><li>  <span class="hljs-attr">xTickSize</span>: <span class="hljs-number">1</span>,</li><li>  <span class="hljs-attr">yTickSize</span>: <span class="hljs-number">1</span>,</li><li></li><li>  <span class="hljs-attr">app</span>: <span class="hljs-literal">null</span>,</li><li></li><li>  <span class="hljs-comment">/**</span></li><li>   * @cfg {Array|Store} shortcuts The items to add to the</li><li>   *      DataView. This can be a {@link Ext.data.Store Store}</li><li>   *      or a simple array. Items should minimally provide</li><li>   *      the fields in the</li><li>   *      {@link Ext.ux.desktop.ShorcutModel ShortcutModel}.</li><li>   */</li><li>  shortcuts: <span class="hljs-literal">null</span>,</li><li></li><li>  <span class="hljs-comment">/**</span></li><li>   * @cfg {String} shortcutItemSelector This property is</li><li>   *      passed to the DataView for the desktop to select</li><li>   *      shortcut items. If the {@link #shortcutTpl} is</li><li>   *      modified, this will probably need to be modified as</li><li>   *      well.</li><li>   */</li><li>  shortcutItemSelector: <span class="hljs-string">'div.ux-desktop-shortcut'</span>,</li><li></li><li>  <span class="hljs-comment">/**</span></li><li>   * @cfg {String} shortcutTpl This XTemplate is used to</li><li>   *      render items in the DataView. If this is changed,</li><li>   *      the {@link shortcutItemSelect} will probably also</li><li>   *      need to changed.</li><li>   */</li><li>  shortcutTpl: [</li><li>      <span class="hljs-string">'&lt;tpl for="."&gt;'</span>,</li><li>      	<span class="hljs-string">'&lt;div class="ux-desktop-shortcut" id="{name}-shortcut"&gt;'</span>,</li><li>          	<span class="hljs-string">'&lt;div class="ux-desktop-shortcut-icon {iconCls}"&gt;'</span>,</li><li>                      <span class="hljs-string">'&lt;img src="'</span>,Ext.BLANK_IMAGE_URL,<span class="hljs-string">'" title="{name}"&gt;'</span>,</li><li>              <span class="hljs-string">'&lt;/div&gt;'</span>,</li><li>              <span class="hljs-string">'&lt;span class="ux-desktop-shortcut-text"&gt;{name}&lt;/span&gt;'</span>,</li><li>          <span class="hljs-string">'&lt;/div&gt;'</span>,</li><li>      <span class="hljs-string">'&lt;/tpl&gt;'</span>,</li><li>      <span class="hljs-string">'&lt;div class="x-clear"&gt;&lt;/div&gt;'</span>],</li><li></li><li>  <span class="hljs-comment">/**</span></li><li>   * @cfg {Object} taskbarConfig The config object for the</li><li>   *      TaskBar.</li><li>   */</li><li>  taskbarConfig: <span class="hljs-literal">null</span>,</li><li></li><li>  <span class="hljs-attr">windowMenu</span>: <span class="hljs-literal">null</span>,</li><li></li><li>  <span class="hljs-attr">initComponent</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>;</li><li></li><li>    me.windowMenu = <span class="hljs-keyword">new</span> Ext.menu.Menu(me.createWindowMenu());</li><li></li><li>    me.bbar = me.taskbar = <span class="hljs-keyword">new</span> Ext.ux.desktop.TaskBar(me.taskbarConfig);</li><li>    me.taskbar.windowMenu = me.windowMenu;</li><li></li><li>    me.windows = <span class="hljs-keyword">new</span> Ext.util.MixedCollection();</li><li></li><li>    me.contextMenu = <span class="hljs-keyword">new</span> Ext.menu.Menu(me.createDesktopMenu());</li><li></li><li>    me.items = [{</li><li>      <span class="hljs-attr">xtype</span>: <span class="hljs-string">'wallpaper'</span>,</li><li>      <span class="hljs-attr">id</span>: me.id + <span class="hljs-string">'_wallpaper'</span></li><li>    }, me.createDataView()];</li><li></li><li>    me.callParent();</li><li></li><li>    me.shortcutsView = me.items.getAt(<span class="hljs-number">1</span>);</li><li>    me.shortcutsView.on(<span class="hljs-string">'itemclick'</span>,me.onShortcutItemClick, me);</li><li></li><li>    <span class="hljs-keyword">var</span> wallpaper = me.wallpaper;</li><li>    me.wallpaper = me.items.getAt(<span class="hljs-number">0</span>);</li><li>    <span class="hljs-keyword">if</span> (wallpaper) {</li><li>      me.setWallpaper(wallpaper, me.wallpaperStretch);</li><li>    }</li><li>  },</li><li></li><li>  <span class="hljs-attr">afterRender</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>;</li><li>    me.callParent();</li><li>    me.el.on(<span class="hljs-string">'contextmenu'</span>, me.onDesktopMenu, me);</li><li>  },</li><li></li><li>  <span class="hljs-attr">createDataView</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>;</li><li>    <span class="hljs-keyword">return</span> {</li><li>      <span class="hljs-attr">xtype</span>: <span class="hljs-string">'dataview'</span>,</li><li>      <span class="hljs-attr">overItemCls</span>: <span class="hljs-string">'x-view-over'</span>,</li><li>      <span class="hljs-attr">trackOver</span>: <span class="hljs-literal">true</span>,</li><li>      <span class="hljs-attr">itemSelector</span>: me.shortcutItemSelector,</li><li>      <span class="hljs-attr">store</span>: me.shortcuts,</li><li>      <span class="hljs-attr">style</span>: {</li><li>        <span class="hljs-attr">position</span>: <span class="hljs-string">'absolute'</span></li><li>      },</li><li>      <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">tpl</span>: <span class="hljs-keyword">new</span> Ext.XTemplate(me.shortcutTpl)</li><li>    };</li><li>  },</li><li></li><li>  <span class="hljs-attr">createDesktopMenu</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>,</li><li>    ret = {</li><li>      <span class="hljs-attr">items</span>: me.contextMenuItems || []</li><li>    };</li><li></li><li>    <span class="hljs-keyword">if</span> (ret.items.length) {</li><li>      ret.items.push(<span class="hljs-string">'-'</span>);</li><li>    }</li><li></li><li>    ret.items.push({</li><li>      <span class="hljs-attr">text</span>: <span class="hljs-string">'平铺窗口'</span>,</li><li>      <span class="hljs-attr">handler</span>: me.tileWindows,</li><li>      <span class="hljs-attr">scope</span>: me,</li><li>      <span class="hljs-attr">minWindows</span>: <span class="hljs-number">1</span></li><li>    }, {</li><li>      <span class="hljs-attr">text</span>: <span class="hljs-string">'折叠窗口'</span>,</li><li>      <span class="hljs-attr">handler</span>: me.cascadeWindows,</li><li>      <span class="hljs-attr">scope</span>: me,</li><li>      <span class="hljs-attr">minWindows</span>: <span class="hljs-number">1</span></li><li>    });</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>  },</li><li></li><li>  <span class="hljs-attr">createWindowMenu</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>;</li><li>    <span class="hljs-keyword">return</span> {</li><li>      <span class="hljs-attr">defaultAlign</span>: <span class="hljs-string">'br-tr'</span>,</li><li>      <span class="hljs-attr">items</span>: [{</li><li>        <span class="hljs-attr">text</span>: <span class="hljs-string">'显示'</span>,</li><li>        <span class="hljs-attr">handler</span>: me.onWindowMenuRestore,</li><li>        <span class="hljs-attr">scope</span>: me</li><li>      }, {</li><li>        <span class="hljs-attr">text</span>: <span class="hljs-string">'最小化'</span>,</li><li>        <span class="hljs-attr">handler</span>: me.onWindowMenuMinimize,</li><li>        <span class="hljs-attr">scope</span>: me</li><li>      }, {</li><li>        <span class="hljs-attr">text</span>: <span class="hljs-string">'最大化'</span>,</li><li>        <span class="hljs-attr">handler</span>: me.onWindowMenuMaximize,</li><li>        <span class="hljs-attr">scope</span>: me</li><li>      }, <span class="hljs-string">'-'</span>, {</li><li>        <span class="hljs-attr">text</span>: <span class="hljs-string">'关闭'</span>,</li><li>        <span class="hljs-attr">handler</span>: me.onWindowMenuClose,</li><li>        <span class="hljs-attr">scope</span>: me</li><li>      }],</li><li>      <span class="hljs-attr">listeners</span>: {</li><li>        <span class="hljs-attr">beforeshow</span>: me.onWindowMenuBeforeShow,</li><li>        <span class="hljs-attr">hide</span>: me.onWindowMenuHide,</li><li>        <span class="hljs-attr">scope</span>: me</li><li>      }</li><li>    };</li><li>  },</li><li></li><li>  <span class="hljs-attr">onDesktopMenu</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, menu = me.contextMenu;</li><li>    e.stopEvent();</li><li>    <span class="hljs-keyword">if</span> (!menu.rendered) {</li><li>      menu.on(<span class="hljs-string">'beforeshow'</span>, me.onDesktopMenuBeforeShow,me);</li><li>    }</li><li>    menu.showAt(e.getXY());</li><li>    menu.doConstrain();</li><li>  },</li><li></li><li>  <span class="hljs-attr">onDesktopMenuBeforeShow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">menu</span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, count = me.windows.getCount();</li><li></li><li>    menu.items.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{</li><li>      <span class="hljs-keyword">var</span> min = item.minWindows || <span class="hljs-number">0</span>;</li><li>      item.setDisabled(count &lt; min);</li><li>    });</li><li>  },</li><li>          </li><li>  <span class="hljs-comment">// 动态添加图标点击事件</span></li><li>  onShortcutItemClick: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dataView, record</span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>;</li><li>    <span class="hljs-keyword">var</span> win = <span class="hljs-literal">null</span>;</li><li>    win = Ext.getCmp(record.data.module);</li><li>    <span class="hljs-keyword">if</span> (!win) {</li><li>      <span class="hljs-comment">// 互获取属性里面的控制器</span></li><li>      <span class="hljs-comment">/*var controller = coreApp.getController(record.data.controller);</span></li><li>      // 实例化控制器</li><li>      if (!controller.inited) {</li><li>        controller.init();</li><li>        controller.inited = true;</li><li>      }*/</li><li>      win = me.createWindow({</li><li>        <span class="hljs-comment">// 窗口的名称和桌面图标名一样</span></li><li>        title: record.data.name,</li><li>        <span class="hljs-comment">// 获取静态变量</span></li><li>        width: comm.get(<span class="hljs-string">"resolutionWidth"</span>) * <span class="hljs-number">0.6</span>,</li><li>        <span class="hljs-attr">height</span>: comm.get(<span class="hljs-string">"resolutionHeight"</span>) * <span class="hljs-number">0.6</span>,</li><li>        <span class="hljs-comment">// 窗口图标</span></li><li>        iconCls: record.data.viewIconCls,</li><li>        <span class="hljs-comment">// 窗口的id 就是我们的模块名称</span></li><li>        id: record.data.module,</li><li>        <span class="hljs-attr">border</span>: <span class="hljs-literal">false</span>,</li><li>        <span class="hljs-attr">hideMode</span>: <span class="hljs-string">'offsets'</span>,</li><li>        <span class="hljs-comment">// 可以关闭</span></li><li>        closable: <span class="hljs-literal">true</span>,</li><li>        <span class="hljs-comment">// 隐藏</span></li><li>        closeAction: <span class="hljs-string">"hide"</span>,</li><li>        <span class="hljs-attr">layout</span>: <span class="hljs-string">"fit"</span>,</li><li>        <span class="hljs-attr">items</span>: {</li><li>          <span class="hljs-attr">xtype</span>: record.data.module + <span class="hljs-string">'-main-view'</span></li><li>        }</li><li>      });</li><li>    }</li><li>    <span class="hljs-comment">// 如果是窗口， 直接显示</span></li><li>    <span class="hljs-comment">// 就是最小化后直接显示数据</span></li><li>    <span class="hljs-keyword">if</span> (win) {</li><li>      me.restoreWindow(win);</li><li>    }</li><li>  },</li><li></li><li>  <span class="hljs-attr">onWindowClose</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">win</span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>;</li><li>    me.windows.remove(win);</li><li>    me.taskbar.removeTaskButton(win.taskButton);</li><li>    me.updateActiveWindow();</li><li>  },</li><li></li><li>  <span class="hljs-attr">onWindowMenuBeforeShow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">menu</span>) </span>{</li><li>    <span class="hljs-keyword">var</span> items = menu.items.items, win = menu.theWin;</li><li>    items[<span class="hljs-number">0</span>].setDisabled(win.maximized !== <span class="hljs-literal">true</span>&amp;&amp; win.hidden !== <span class="hljs-literal">true</span>); <span class="hljs-comment">// Restore</span></li><li>    items[<span class="hljs-number">1</span>].setDisabled(win.minimized === <span class="hljs-literal">true</span>); <span class="hljs-comment">// Minimize</span></li><li>    items[<span class="hljs-number">2</span>].setDisabled(win.maximized === <span class="hljs-literal">true</span>|| win.hidden === <span class="hljs-literal">true</span>); <span class="hljs-comment">// Maximize</span></li><li>  },</li><li></li><li>  <span class="hljs-attr">onWindowMenuClose</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, win = me.windowMenu.theWin;</li><li>    win.close();</li><li>  },</li><li></li><li>  <span class="hljs-attr">onWindowMenuHide</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">menu</span>) </span>{</li><li>    Ext.defer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>      menu.theWin = <span class="hljs-literal">null</span>;</li><li>    }, <span class="hljs-number">1</span>);</li><li>  },</li><li></li><li>  <span class="hljs-attr">onWindowMenuMaximize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, win = me.windowMenu.theWin;</li><li>    win.maximize();</li><li>    win.toFront();</li><li>  },</li><li></li><li>  <span class="hljs-attr">onWindowMenuMinimize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, win = me.windowMenu.theWin;</li><li></li><li>    win.minimize();</li><li>  },</li><li></li><li>  <span class="hljs-attr">onWindowMenuRestore</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, win = me.windowMenu.theWin;</li><li>    me.restoreWindow(win);</li><li>  },</li><li></li><li>  <span class="hljs-attr">getWallpaper</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.wallpaper.wallpaper;</li><li>  },</li><li></li><li>  <span class="hljs-attr">setTickSize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xTickSize, yTickSize</span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, xt = me.xTickSize = xTickSize, yt = me.yTickSize = (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>) ? yTickSize: xt;</li><li></li><li>    me.windows.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">win</span>) </span>{</li><li>      <span class="hljs-keyword">var</span> dd = win.dd, resizer = win.resizer;</li><li>      dd.xTickSize = xt;</li><li>      dd.yTickSize = yt;</li><li>      resizer.widthIncrement = xt;</li><li>      resizer.heightIncrement = yt;</li><li>    });</li><li>  },</li><li></li><li>  <span class="hljs-attr">setWallpaper</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">wallpaper, stretch</span>) </span>{</li><li>    <span class="hljs-keyword">this</span>.wallpaper.setWallpaper(wallpaper, stretch);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</li><li>  },</li><li></li><li>  <span class="hljs-attr">cascadeWindows</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>, zmgr = <span class="hljs-keyword">this</span>.getDesktopZIndexManager();</li><li></li><li>    zmgr.eachBottomUp(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">win</span>) </span>{</li><li>      <span class="hljs-keyword">if</span> (win.isWindow &amp;&amp; win.isVisible()&amp;&amp; !win.maximized) {</li><li>        win.setPosition(x, y);</li><li>        x += <span class="hljs-number">20</span>;</li><li>        y += <span class="hljs-number">20</span>;</li><li>      }</li><li>    });</li><li>  },</li><li></li><li>  <span class="hljs-attr">createWindow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config, cls</span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, win, cfg = Ext.applyIf(config || {}, {</li><li>      <span class="hljs-attr">stateful</span>: <span class="hljs-literal">false</span>,</li><li>      <span class="hljs-attr">isWindow</span>: <span class="hljs-literal">true</span>,</li><li>      <span class="hljs-attr">constrainHeader</span>: <span class="hljs-literal">true</span>,</li><li>      <span class="hljs-attr">minimizable</span>: <span class="hljs-literal">true</span>,</li><li>      <span class="hljs-attr">maximizable</span>: <span class="hljs-literal">true</span></li><li>    });</li><li>    cls = cls || Ext.window.Window;</li><li>    win = me.add(<span class="hljs-keyword">new</span> cls(cfg));</li><li>    me.windows.add(win);</li><li></li><li>    win.taskButton = me.taskbar.addTaskButton(win);</li><li>    win.animateTarget = win.taskButton.el;</li><li></li><li>    win.on({</li><li>      <span class="hljs-attr">activate</span>: me.updateActiveWindow,</li><li>      <span class="hljs-attr">beforeshow</span>: me.updateActiveWindow,</li><li>      <span class="hljs-attr">deactivate</span>: me.updateActiveWindow,</li><li>      <span class="hljs-attr">minimize</span>: me.minimizeWindow,</li><li>      <span class="hljs-attr">destroy</span>: me.onWindowClose,</li><li>      <span class="hljs-attr">scope</span>: me</li><li>    });</li><li></li><li>    win.on({</li><li>      <span class="hljs-attr">boxready</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>        win.dd.xTickSize = me.xTickSize;</li><li>        win.dd.yTickSize = me.yTickSize;</li><li></li><li>        <span class="hljs-keyword">if</span> (win.resizer) {</li><li>          win.resizer.widthIncrement = me.xTickSize;</li><li>          win.resizer.heightIncrement = me.yTickSize;</li><li>        }</li><li>      },</li><li>      <span class="hljs-attr">single</span>: <span class="hljs-literal">true</span></li><li>    });</li><li></li><li>    win.doClose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>      win.doClose = Ext.emptyFn; </li><li>      win.el.disableShadow();</li><li>      win.el.fadeOut({</li><li>        <span class="hljs-attr">listeners</span>: {</li><li>          <span class="hljs-attr">afteranimate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>            win.destroy();</li><li>          }</li><li>        }</li><li>      });</li><li>    };</li><li></li><li>    <span class="hljs-keyword">return</span> win;</li><li>  },</li><li></li><li>  <span class="hljs-attr">getActiveWindow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> win = <span class="hljs-literal">null</span>, zmgr = <span class="hljs-keyword">this</span>.getDesktopZIndexManager();</li><li></li><li>    <span class="hljs-keyword">if</span> (zmgr) {</li><li>      zmgr.eachTopDown(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">comp</span>) </span>{</li><li>        <span class="hljs-keyword">if</span> (comp.isWindow &amp;&amp; !comp.hidden) {</li><li>          win = comp;</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>        }</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>      });</li><li>    }</li><li></li><li>    <span class="hljs-keyword">return</span> win;</li><li>  },</li><li></li><li>  <span class="hljs-attr">getDesktopZIndexManager</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> windows = <span class="hljs-keyword">this</span>.windows;</li><li>    <span class="hljs-keyword">return</span> (windows.getCount() &amp;&amp; windows.getAt(<span class="hljs-number">0</span>).zIndexManager)|| <span class="hljs-literal">null</span>;</li><li>  },</li><li></li><li>  <span class="hljs-attr">getWindow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.windows.get(id);</li><li>  },</li><li></li><li>  <span class="hljs-attr">minimizeWindow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">win</span>) </span>{</li><li>    win.minimized = <span class="hljs-literal">true</span>;</li><li>    win.hide();</li><li>  },</li><li></li><li>  <span class="hljs-attr">restoreWindow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">win</span>) </span>{</li><li>    <span class="hljs-keyword">if</span> (win.isVisible()) {</li><li>      win.restore();</li><li>      win.toFront();</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      win.show();</li><li>    }</li><li>    <span class="hljs-keyword">return</span> win;</li><li>  },</li><li></li><li>  <span class="hljs-attr">tileWindows</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, availWidth = me.body.getWidth(<span class="hljs-literal">true</span>);</li><li>    <span class="hljs-keyword">var</span> x = me.xTickSize, y = me.yTickSize, nextY = y;</li><li></li><li>    me.windows.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">win</span>) </span>{</li><li>      <span class="hljs-keyword">if</span> (win.isVisible() &amp;&amp; !win.maximized) {</li><li>        <span class="hljs-keyword">var</span> w = win.el.getWidth();</li><li></li><li>        <span class="hljs-comment">// Wrap to next row if we are not at the line</span></li><li>        <span class="hljs-comment">// start and this Window will</span></li><li>        <span class="hljs-comment">// go off the end</span></li><li>        <span class="hljs-keyword">if</span> (x &gt; me.xTickSize &amp;&amp; x + w &gt; availWidth) {</li><li>          x = me.xTickSize;</li><li>          y = nextY;</li><li>        }</li><li></li><li>        win.setPosition(x, y);</li><li>        x += w + me.xTickSize;</li><li>        nextY = <span class="hljs-built_in">Math</span>.max(nextY, y + win.el.getHeight()+ me.yTickSize);</li><li>      }</li><li>    });</li><li>  },</li><li></li><li>  <span class="hljs-attr">updateActiveWindow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>    <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, activeWindow = me.getActiveWindow(), last = me.lastActiveWindow;</li><li>    <span class="hljs-keyword">if</span> (activeWindow === last) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li></li><li>    <span class="hljs-keyword">if</span> (last) {</li><li>      <span class="hljs-keyword">if</span> (last.el.dom) {</li><li>        last.addCls(me.inactiveWindowCls);</li><li>        last.removeCls(me.activeWindowCls);</li><li>      }</li><li>      last.active = <span class="hljs-literal">false</span>;</li><li>    }</li><li></li><li>    me.lastActiveWindow = activeWindow;</li><li></li><li>    <span class="hljs-keyword">if</span> (activeWindow) {</li><li>      activeWindow.addCls(me.activeWindowCls);</li><li>      activeWindow.removeCls(me.inactiveWindowCls);</li><li>      activeWindow.minimized = <span class="hljs-literal">false</span>;</li><li>      activeWindow.active = <span class="hljs-literal">true</span>;</li><li>    }</li><li></li><li>    me.taskbar.setActiveButton(activeWindow &amp;&amp; activeWindow.taskButton);</li><li>  }</li><li>});</li></ol></code></pre>
			<div><br />
			</div>
		</div>
		<div>7.修改官方例子使其支持mvc模式，为了不改动ext自带的例子，在web/desktop目录下创建我们自己的App.js文件，继承Ext.ux.desktop.App，代码如下：
		</div>
		<div>
			<pre>
<code id="ID_162DD10E086" class="lang-javascript hljs"><ol><li>Ext.define(<span class="hljs-string">'MyDesktop.App'</span>, {</li><li>    <span class="hljs-attr">extend</span>: <span class="hljs-string">'Ext.ux.desktop.App'</span>,</li><li></li><li>    <span class="hljs-attr">requires</span>: [</li><li>        <span class="hljs-comment">//消息弹出框</span></li><li>        <span class="hljs-string">'Ext.window.MessageBox'</span>,</li><li>        <span class="hljs-comment">//手工输入 module,这个是左面图标对象</span></li><li>        <span class="hljs-string">'Ext.ux.desktop.Module'</span>,</li><li>        <span class="hljs-comment">//图标Model</span></li><li>        <span class="hljs-string">'Ext.ux.desktop.ShortcutModel'</span>,</li><li>        <span class="hljs-string">'MyDesktop.Settings'</span></li><li>    ],</li><li></li><li>    <span class="hljs-attr">init</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>        <span class="hljs-keyword">this</span>.callParent();</li><li>    },</li><li></li><li>    <span class="hljs-attr">getModules</span> : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</li><li>    	<span class="hljs-comment">//没有模块 </span></li><li>        <span class="hljs-keyword">return</span> [];</li><li>    },</li><li></li><li>    <span class="hljs-attr">getDesktopConfig</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</li><li>        <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, ret = me.callParent();</li><li></li><li>        <span class="hljs-keyword">return</span> Ext.apply(ret, {</li><li>        	<span class="hljs-comment">//右键菜单</span></li><li>        	contextMenuItems: [{ </li><li>        		<span class="hljs-attr">text</span>: <span class="hljs-string">'修改背景'</span>, </li><li>        		<span class="hljs-attr">handler</span>: me.onSettings, </li><li>        		<span class="hljs-attr">scope</span>: me </li><li>        	}],</li><li>      </li><li>            <span class="hljs-comment">//桌面图标快捷方式</span></li><li>            shortcuts: Ext.create(<span class="hljs-string">'Ext.data.Store'</span>, {</li><li>                <span class="hljs-attr">model</span>: <span class="hljs-string">'Ext.ux.desktop.ShortcutModel'</span>,</li><li>                <span class="hljs-attr">data</span>: [{ </li><li>                	<span class="hljs-attr">name</span>: <span class="hljs-string">'用户管理'</span>,  <span class="hljs-comment">//显示的名称</span></li><li>                	iconCls: <span class="hljs-string">'customers'</span>, <span class="hljs-comment">//桌面显示的图标</span></li><li>                	viewIconCls:<span class="hljs-string">"icon_customers"</span>, <span class="hljs-comment">//任务栏和界面显示的图标</span></li><li>                	<span class="hljs-comment">//xtype:"userpanel", //类型</span></li><li>                	<span class="hljs-comment">//controller:"apps.user.controller.UserController", //控制对象</span></li><li>                	<span class="hljs-built_in">module</span>:<span class="hljs-string">"user"</span> <span class="hljs-comment">//模型</span></li><li>                }]</li><li>            }),</li><li>      <span class="hljs-comment">//设定桌面的背景</span></li><li>            wallpaper: <span class="hljs-string">'web/desktop/wallpapers/Wood-Sencha.jpg'</span>,</li><li>            <span class="hljs-attr">wallpaperStretch</span>: <span class="hljs-literal">false</span></li><li>            </li><li>        });</li><li>    },</li><li></li><li>    <span class="hljs-comment">// 设定开始菜单</span></li><li>    getStartConfig : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</li><li>        <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>, ret = me.callParent();</li><li></li><li>        <span class="hljs-keyword">return</span> Ext.apply(ret, {</li><li>            <span class="hljs-attr">title</span>: <span class="hljs-string">'桌面系统'</span>,</li><li>            <span class="hljs-attr">iconCls</span>: <span class="hljs-string">'settings'</span>,</li><li>            <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>,</li><li>            <span class="hljs-attr">toolConfig</span>: {</li><li>                <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,</li><li>                <span class="hljs-attr">items</span>: [{</li><li>                	<span class="hljs-attr">text</span>:<span class="hljs-string">'系统设定'</span>,</li><li>                    <span class="hljs-attr">iconCls</span>:<span class="hljs-string">'settings'</span>,</li><li>                    <span class="hljs-attr">handler</span>: me.onSettings,</li><li>                    <span class="hljs-attr">scope</span>: me</li><li>                },<span class="hljs-string">'-'</span>,{</li><li>                    <span class="hljs-attr">text</span>:<span class="hljs-string">'退出系统'</span>,</li><li>                    <span class="hljs-attr">iconCls</span>:<span class="hljs-string">'logout'</span>,</li><li>                    <span class="hljs-attr">handler</span>: me.onLogout,</li><li>                    <span class="hljs-attr">scope</span>: me</li><li>                }]</li><li>            }</li><li>        });</li><li>    },</li><li></li><li>    <span class="hljs-comment">//任务栏快捷方式</span></li><li>    getTaskbarConfig: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</li><li>        <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">this</span>.callParent();</li><li></li><li>        <span class="hljs-keyword">return</span> Ext.apply(ret, {</li><li>            <span class="hljs-attr">quickStart</span>: [{ </li><li>            	<span class="hljs-attr">name</span>: <span class="hljs-string">'折叠窗口'</span>, </li><li>            	<span class="hljs-attr">iconCls</span>: <span class="hljs-string">'accordion'</span>, </li><li>            	<span class="hljs-attr">module</span>: <span class="hljs-string">'acc-win'</span> </li><li>            },{ </li><li>            	<span class="hljs-attr">name</span>: <span class="hljs-string">'平铺窗口'</span>, </li><li>            	<span class="hljs-attr">iconCls</span>: <span class="hljs-string">'icon-grid'</span>, </li><li>            	<span class="hljs-attr">module</span>: <span class="hljs-string">'grid-win'</span> </li><li>            }],</li><li>            <span class="hljs-attr">trayItems</span>: [{ </li><li>            	<span class="hljs-attr">xtype</span>: <span class="hljs-string">'trayclock'</span>, </li><li>            	<span class="hljs-attr">flex</span>: <span class="hljs-number">1</span> </li><li>            }]</li><li>        });</li><li>    },</li><li></li><li>    <span class="hljs-comment">//点击退出系统事件</span></li><li>    onLogout: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</li><li>        Ext.Msg.confirm(<span class="hljs-string">'系统提示'</span>, <span class="hljs-string">'你真的要退出?'</span>);</li><li>    },</li><li></li><li>    <span class="hljs-comment">//点击设置事件</span></li><li>    onSettings: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</li><li>        <span class="hljs-keyword">var</span> dlg = <span class="hljs-keyword">new</span> MyDesktop.Settings({</li><li>            <span class="hljs-attr">desktop</span>: <span class="hljs-keyword">this</span>.desktop</li><li>        });</li><li>        dlg.show();</li><li>    }</li><li>});</li></ol></code></pre>
			<div><br />
			</div>
		</div>
		<div>8.打开Settings.js文件，找到createTree方法中store定义中的代码，将背景图片的路径全部给为正确的路径，示例如下：
		</div>
		<div>
			<pre>
<code id="ID_162DD16F854" class="lang-javascript hljs"><ol><li>../web/desktop/wallpapers/Blue-Sencha.jpg</li></ol></code></pre>
			<div>将createTree方法中store下的model改为：
			</div>
			<div>
				<pre>
<code id="ID_162DD4CF785" class="lang-javascript hljs"><ol><li>model: Ext.define(<span class="hljs-string">'WallpaperModel'</span>,{</li><li><span class="hljs-attr">    extend</span>: <span class="hljs-string">'Ext.data.Model'</span>,</li><li>    <span class="hljs-attr">fields</span>: [{</li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">'text'</span></li><li>    },{</li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">'img'</span></li><li>    }]</li><li>}),</li></ol></code></pre>
				<div>同时删除Settings.js中的WallpaperModel引用。
				</div>
			</div>
			<div><br />
			</div>
		</div>
		<div>9.在web目录下创建common/css，common/js目录，css代码为图片以及样式文件，在common/js下新建comm.js文件，代码如下：
		</div>
		<div>
			<pre>
<code id="ID_162DD1D11C5" class="lang-javascript hljs"><ol><li><span class="hljs-comment">/**</span></li><li> * 静态变量的声明，通过这个工具类来声明静态变量</li><li> */</li><li><span class="hljs-keyword">var</span> comm = Ext.create(<span class="hljs-string">"Ext.util.MixedCollection"</span>);</li></ol></code></pre>
			<div><br />
			</div>
		</div>
		<div>10.web目录下新建apps目录，用来存放我们的功能模块
		</div>
		<div><br />
		</div>
		<div>11.测试：web/apps下新建user/view，user/controller目录，在user/view下新建MainView.js文件，代码如下：
		</div>
		<div>
			<pre>
<code id="ID_162DD209F6E" class="lang-javascript hljs"><ol><li>Ext.define(<span class="hljs-string">"apps.user.view.MainView"</span>,{</li><li>  <span class="hljs-attr">extend</span>:<span class="hljs-string">"Ext.panel.Panel"</span>,</li><li>  <span class="hljs-attr">xtype</span>: <span class="hljs-string">'user-main-view'</span>,</li><li>  </li><li>  <span class="hljs-attr">html</span>: <span class="hljs-number">1111</span></li><li>});</li></ol></code></pre>
			<div>在user/controller下新建UserController.js文件，代码如下：
			</div>
		</div>
		<div>
			<pre>
<code id="ID_162DD23E39A" class="lang-javascript hljs"><ol><li>Ext.define(<span class="hljs-string">"apps.user.controller.UserController"</span>,{</li><li>  <span class="hljs-attr">extend</span>:<span class="hljs-string">"Ext.app.Controller"</span>,</li><li>  <span class="hljs-attr">views</span>: [<span class="hljs-string">'MainView'</span>],</li><li>  </li><li>  <span class="hljs-attr">init</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</li><li>  }</li><li>});</li></ol></code></pre>
			<div>在user目录下新建app.js文件，代码如下：
			</div>
		</div>
		<div>
			<pre>
<code id="ID_162DD24835B" class="lang-javascript hljs"><ol><li>Ext.define(<span class="hljs-string">'apps.user.app'</span>,{</li><li>  <span class="hljs-attr">extend</span>: <span class="hljs-string">'Ext.app.Application'</span>,</li><li>  </li><li>  <span class="hljs-attr">name</span>: <span class="hljs-string">'apps.user'</span>,</li><li>  <span class="hljs-attr">appFolder</span>: <span class="hljs-string">'web/apps/user'</span>,</li><li>  </li><li>  <span class="hljs-comment">//autoCreateViewport: true,</span></li><li>  </li><li>  controllers: [<span class="hljs-string">'UserController'</span>]</li><li>});</li></ol></code></pre>
			<div><br />
			</div>
			<div>12.在apps目录下新建loader.js全局启动器，代码如下：
			</div>
		</div>
		<div>
			<pre>
<code id="ID_162DD2766FB" class="lang-javascript hljs"><ol><li><span class="hljs-comment">//启用下面两个，就可以启用提示</span></li><li>Ext.QuickTips.init();</li><li><span class="hljs-comment">//初始化提示工具框</span></li><li>Ext.tip.QuickTipManager.init();</li><li></li><li><span class="hljs-comment">//启用动态加载机制</span></li><li>Ext.Loader.setConfig({</li><li>  <span class="hljs-attr">enabled</span>:<span class="hljs-literal">true</span>,</li><li>  <span class="hljs-attr">paths</span>:{</li><li>    <span class="hljs-attr">apps</span>: <span class="hljs-string">'web/apps'</span></li><li>  }</li><li>});</li><li></li><li>Ext.onReady(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</li><li>  Ext.application(<span class="hljs-string">'apps.user.app'</span>)</li><li>});</li><li></li><li></li><li><span class="hljs-comment">//同步加载</span></li><li>Ext.syncRequire([</li><li>  <span class="hljs-comment">//"baseUx.form.datetime.DateTimePicker",</span></li><li>    <span class="hljs-comment">//"baseUx.form.datetime.DateTime"</span></li><li>]);</li></ol></code></pre>
			<div>13.ShortcutModel.js修改如下：
			</div>
			<div>
				<pre>
<code id="ID_1643B3DE985" class="lang-javascript hljs"><ol><li><span class="hljs-comment">/*!</span></li><li> * Ext JS Library 4.0</li><li> * Copyright(c) 2006-2011 Sencha Inc.</li><li> * licensing@sencha.com</li><li> * http://www.sencha.com/license</li><li> */</li><li></li><li><span class="hljs-comment">/**</span></li><li> * @class Ext.ux.desktop.ShortcutModel</li><li> * @extends Ext.data.Model</li><li> * This model defines the minimal set of fields for desktop shortcuts.</li><li> */</li><li>Ext.define(<span class="hljs-string">'Ext.ux.desktop.ShortcutModel'</span>, {</li><li>    <span class="hljs-attr">extend</span>: <span class="hljs-string">'Ext.data.Model'</span>,</li><li>    <span class="hljs-attr">fields</span>: [</li><li>       { <span class="hljs-attr">name</span>: <span class="hljs-string">'name'</span> },</li><li>       { <span class="hljs-attr">name</span>: <span class="hljs-string">'iconCls'</span> },</li><li>       { <span class="hljs-attr">name</span>: <span class="hljs-string">'module'</span> },</li><li>     <span class="hljs-comment">//窗口类型</span></li><li>       {<span class="hljs-attr">name</span>:<span class="hljs-string">"xtype"</span>},</li><li>       <span class="hljs-comment">//控制器</span></li><li>       {<span class="hljs-attr">name</span>:<span class="hljs-string">"controller"</span>},</li><li>       <span class="hljs-comment">//窗口的 样式</span></li><li>       {<span class="hljs-attr">name</span>:<span class="hljs-string">"viewIconCls"</span>}</li><li>    ]</li><li>});</li></ol></code></pre>
				<div>14.index.html
				</div>
			</div>
			<div>
				<pre>
<code id="ID_1643B52A88D" class="lang-javascript hljs"><ol><li>&lt;!DOCTYPE html&gt;</li><li>&lt;html&gt;</li><li>    &lt;head&gt;</li><li>        &lt;meta charset="UTF-8"&gt;</li><li>        &lt;title&gt;Insert title here&lt;/title&gt;</li><li>        &lt;!-- 系统的css样式 --&gt;</li><li>  		&lt;link rel="stylesheet" type="text/css" href="web/extjs/resources/css/ext-all.css" /&gt;</li><li>  		&lt;link rel="stylesheet" type="text/css" href="web/extjs/examples/shared/example.css" /&gt;</li><li>  		&lt;link rel="stylesheet" type="text/css" href="web/extjs/examples/ux/css/TabScrollerMenu.css" /&gt;</li><li>  		&lt;link rel="stylesheet" type="text/css" href="web/extjs/examples/ux/css/ItemSelector.css" /&gt;</li><li>  		&lt;link rel="stylesheet" type="text/css" href="web/desktop/css/desktop.css" /&gt;</li><li>  		</li><li>  		&lt;!-- 自定义css样式 --&gt;</li><li>  		&lt;link rel="stylesheet" type="text/css" href="web/common/css/comm.css" /&gt;</li><li>  		</li><li>  		&lt;!-- 导入js文件 --&gt;</li><li>  		&lt;script type="text/javascript" src="web/extjs/ext-all-dev.js"&gt;&lt;/script&gt;</li><li>  		&lt;script type="text/javascript" src="web/extjs/locale/ext-lang-zh_CN.js"&gt;&lt;/script&gt;</li><li></li><li>   		&lt;!--项目入口  --&gt;</li><li>   </li><li>   		&lt;!--外部组建--&gt;</li><li>   		&lt;script type="text/javascript" src="web/apps/loader.js"&gt;&lt;/script&gt;</li><li>   		</li><li>  		&lt;!-- 自己定义的组建 --&gt; </li><li>  		&lt;!-- 下面这句如果引用就会找不到Ext.ux.desktop路径，暂时没有找到原因 --&gt;</li><li>  		&lt;!-- &lt;script type="text/javascript" src="web/desktop/App.js"&gt;&lt;/script&gt; --&gt;</li><li>   </li><li>   		&lt;!-- 静态变量声明 --&gt;</li><li>  		&lt;script type="text/javascript" src="web/common/js/comm.js"&gt;&lt;/script&gt;</li><li>  </li><li>  		&lt;!-- 导入example.js --&gt;</li><li>  		&lt;script type="text/javascript" src="web/extjs/examples/shared/examples.js"&gt;&lt;/script&gt;</li><li>  		&lt;link style="text/css" rel="stylesheet" href="web/extjs/examples/shared/example.css"/&gt;</li><li>        </li><li>    &lt;/head&gt;</li><li>    </li><li>    &lt;body&gt;</li><li>        &lt;script type="text/javascript"&gt;</li><li>            &lt;!-- 加载分辨率大小，添加静态变量 --&gt;</li><li>            var clientWidth = document.body.clientWidth;</li><li>            var clientHeight = document.body.clientHeight;</li><li>            var screenWidth = document.body.scrollWidth;</li><li>            var screenHeight = document.body.scrollHeight;</li><li>            var resolutionHeight = window.screen.height;</li><li>            var resolutionWidth = window.screen.width;</li><li>            comm.add("clientWidth",clientWidth);</li><li>            comm.add("clientHeight",clientHeight);</li><li>            comm.add("screenWidth",screenWidth);</li><li>            comm.add("screenHeight",screenHeight);</li><li>            comm.add("resolutionWidth",resolutionWidth);</li><li>            comm.add("resolutionHeight",resolutionHeight);</li><li>            </li><li>            &lt;!--改造窗体的层次--&gt;</li><li>            Ext.override(Ext.ZIndexManager, {</li><li>            	tempHidden: [],</li><li>                show: function () {</li><li>                	var comp, x, y;</li><li>                    while (comp = this.tempHidden.shift()) {</li><li>                    	x = comp.x;</li><li>                        y = comp.y;</li><li>                        comp.show();</li><li>                        comp.setPosition(x, y);</li><li>                    }</li><li>                }</li><li>            });</li><li>            </li><li>            &lt;!--加载程序--&gt;</li><li>            Ext.Loader.setConfig({</li><li>            	enabled: true,</li><li>                paths: {</li><li>                	//导入MyDesktop 的路径</li><li>                    //这个路径要弄对，不然找不到, </li><li>                    //'Ext.ux.desktop': 'MyDesktop/js',</li><li>                    //我们的MyDesktop 的路径</li><li>                    'MyDesktop': 'web/desktop',</li><li>                    'Ext.ux.desktop': 'web/desktop/js'</li><li>                }</li><li>            });</li><li>            </li><li>            &lt;!--引用类--&gt;</li><li>            Ext.require(['MyDesktop.App']);</li><li>            </li><li>            &lt;!--实例化--&gt;</li><li>            var myDesktopApp;</li><li>            Ext.onReady(function () {</li><li>            	myDesktopApp = new MyDesktop.App();</li><li>            });</li><li>        &lt;/script&gt;</li><li>    &lt;/body&gt;</li><li>&lt;/html&gt;</li></ol></code></pre>
				<div><br />
				</div>
			</div>
		</div>
		<div><br />
		</div>
	</body>
</html>
