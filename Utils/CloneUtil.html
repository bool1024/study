<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<link rel="stylesheet" type="text/css" href="file:///${exe}/scripts/highlight.styles/${SyntaxHighlightStyleName}.css" />
		<style>
			table{border-collapse: collapse; border: 1px solid gray; border-width: 2px 1px 2px 1px;}
			th{border: 1px solid gray; padding: 4px; background-color: #ddd;}
			td{border: 1px solid gray; padding: 4px;}
			tr:nth-child(2n){background-color: #f8f8f8;}
			pre{border: 2px solid #d6d6d6; padding: 0px; border-radius: 3px;}
		</style>
	</head>
	<body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">
		<div>
			<div><br />
			</div>
			<pre>
<code id="ID_1634DDA9457" class="lang-java hljs"><ol><li><span class="hljs-keyword">package</span> com.cmcc.omc.common;</li><li><span class="hljs-keyword">import</span> java.lang.reflect.Field;</li><li><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;</li><li><span class="hljs-keyword">import</span> java.lang.reflect.Modifier;</li><li><span class="hljs-keyword">import</span> java.util.Arrays;</li><li><span class="hljs-keyword">import</span> java.util.Collection;</li><li><span class="hljs-keyword">import</span> java.util.HashSet;</li><li><span class="hljs-keyword">import</span> java.util.Map;</li><li><span class="hljs-keyword">import</span> java.util.Set;</li><li><br></li><li><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CloneUtil</span></span></li><li>{</li><li>    <span class="hljs-comment">/**</span></li><li>     * 无需进行复制的特殊类型数组</li><li>     */</li><li>    <span class="hljs-keyword">static</span> Class[] needlessCloneClasses = <span class="hljs-keyword">new</span> Class[] { String.class, Boolean.class, Character.class, Byte.class,</li><li>            Short.class, Integer.class, Long.class, Float.class, Double.class, Void.class, Object.class, Class.class };</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 判断该类型对象是否无需复制</li><li>     * <span class="hljs-doctag">@param</span> c 指定类型</li><li>     * <span class="hljs-doctag">@return</span> 如果不需要复制则返回真，否则返回假</li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isNeedlessClone</span><span class="hljs-params">(Class c)</span></span></li><li>    {</li><li>        <span class="hljs-keyword">if</span> (c.isPrimitive())</li><li>        {<span class="hljs-comment">// 基本类型</span></li><li>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</li><li>        }</li><li>        <span class="hljs-keyword">for</span> (Class tmp : needlessCloneClasses)</li><li>        {<span class="hljs-comment">// 是否在无需复制类型数组里</span></li><li>            <span class="hljs-keyword">if</span> (c.equals(tmp))</li><li>            {</li><li>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</li><li>            }</li><li>        }</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 尝试创建新对象</li><li>     * <span class="hljs-doctag">@param</span> c 原始对象</li><li>     * <span class="hljs-doctag">@return</span> 新的对象</li><li>     * <span class="hljs-doctag">@throws</span> IllegalAccessException</li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">createObject</span><span class="hljs-params">(Object value)</span> <span class="hljs-keyword">throws</span> IllegalAccessException</span></li><li>    {</li><li>        <span class="hljs-keyword">try</span></li><li>        {</li><li>            <span class="hljs-keyword">return</span> value.getClass().newInstance();</li><li>        }</li><li>        <span class="hljs-keyword">catch</span> (InstantiationException e)</li><li>        {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</li><li>        }</li><li>        <span class="hljs-keyword">catch</span> (IllegalAccessException e)</li><li>        {</li><li>            <span class="hljs-keyword">throw</span> e;</li><li>        }</li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 复制对象数据</li><li>     * <span class="hljs-doctag">@param</span> value 原始对象</li><li>     * <span class="hljs-doctag">@param</span> level 复制深度。小于0为无限深度，即将深入到最基本类型和Object类级别的数据复制； 大于0则按照其值复制到指定深度的数据，等于0则直接返回对象本身而不进行任何复制行为。</li><li>     * <span class="hljs-doctag">@return</span> 返回复制后的对象</li><li>     * <span class="hljs-doctag">@throws</span> IllegalAccessException</li><li>     * <span class="hljs-doctag">@throws</span> InstantiationException</li><li>     * <span class="hljs-doctag">@throws</span> InvocationTargetException</li><li>     * <span class="hljs-doctag">@throws</span> NoSuchMethodException</li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">clone</span><span class="hljs-params">(Object value, <span class="hljs-keyword">int</span> level)</span></span></li><li>            <span class="hljs-keyword">throws</span> IllegalAccessException, InstantiationException, InvocationTargetException, NoSuchMethodException</li><li>    {</li><li>        <span class="hljs-keyword">if</span> (value == <span class="hljs-keyword">null</span>)</li><li>        {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (level == <span class="hljs-number">0</span>)</li><li>        {</li><li>            <span class="hljs-keyword">return</span> value;</li><li>        }</li><li>        Class c = value.getClass();</li><li>        <span class="hljs-keyword">if</span> (isNeedlessClone(c))</li><li>        {</li><li>            <span class="hljs-keyword">return</span> value;</li><li>        }</li><li>        level--;</li><li>        <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> Collection)</li><li>        {<span class="hljs-comment">// 复制新的集合</span></li><li>            Collection tmp = (Collection) c.newInstance();</li><li>            <span class="hljs-keyword">for</span> (Object v : (Collection) value)</li><li>            {</li><li>                tmp.add(clone(v, level));<span class="hljs-comment">// 深度复制</span></li><li>            }</li><li>            value = tmp;</li><li>        }</li><li>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c.isArray())</li><li>        {<span class="hljs-comment">// 复制新的Array</span></li><li>            <span class="hljs-comment">// 首先判断是否为基本数据类型</span></li><li>            <span class="hljs-keyword">if</span> (c.equals(<span class="hljs-keyword">int</span>[].class))</li><li>            {</li><li>                <span class="hljs-keyword">int</span>[] old = (<span class="hljs-keyword">int</span>[]) value;</li><li>                value = (<span class="hljs-keyword">int</span>[]) Arrays.copyOf(old, old.length);</li><li>            }</li><li>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c.equals(<span class="hljs-keyword">short</span>[].class))</li><li>            {</li><li>                <span class="hljs-keyword">short</span>[] old = (<span class="hljs-keyword">short</span>[]) value;</li><li>                value = (<span class="hljs-keyword">short</span>[]) Arrays.copyOf(old, old.length);</li><li>            }</li><li>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c.equals(<span class="hljs-keyword">char</span>[].class))</li><li>            {</li><li>                <span class="hljs-keyword">char</span>[] old = (<span class="hljs-keyword">char</span>[]) value;</li><li>                value = (<span class="hljs-keyword">char</span>[]) Arrays.copyOf(old, old.length);</li><li>            }</li><li>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c.equals(<span class="hljs-keyword">float</span>[].class))</li><li>            {</li><li>                <span class="hljs-keyword">float</span>[] old = (<span class="hljs-keyword">float</span>[]) value;</li><li>                value = (<span class="hljs-keyword">float</span>[]) Arrays.copyOf(old, old.length);</li><li>            }</li><li>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c.equals(<span class="hljs-keyword">double</span>[].class))</li><li>            {</li><li>                <span class="hljs-keyword">double</span>[] old = (<span class="hljs-keyword">double</span>[]) value;</li><li>                value = (<span class="hljs-keyword">double</span>[]) Arrays.copyOf(old, old.length);</li><li>            }</li><li>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c.equals(<span class="hljs-keyword">long</span>[].class))</li><li>            {</li><li>                <span class="hljs-keyword">long</span>[] old = (<span class="hljs-keyword">long</span>[]) value;</li><li>                value = (<span class="hljs-keyword">long</span>[]) Arrays.copyOf(old, old.length);</li><li>            }</li><li>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c.equals(<span class="hljs-keyword">boolean</span>[].class))</li><li>            {</li><li>                <span class="hljs-keyword">boolean</span>[] old = (<span class="hljs-keyword">boolean</span>[]) value;</li><li>                value = (<span class="hljs-keyword">boolean</span>[]) Arrays.copyOf(old, old.length);</li><li>            }</li><li>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c.equals(<span class="hljs-keyword">byte</span>[].class))</li><li>            {</li><li>                <span class="hljs-keyword">byte</span>[] old = (<span class="hljs-keyword">byte</span>[]) value;</li><li>                value = (<span class="hljs-keyword">byte</span>[]) Arrays.copyOf(old, old.length);</li><li>            }</li><li>            <span class="hljs-keyword">else</span></li><li>            {</li><li>                Object[] old = (Object[]) value;</li><li>                Object[] tmp = (Object[]) Arrays.copyOf(old, old.length, old.getClass());</li><li>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; old.length; i++)</li><li>                {</li><li>                    tmp[i] = clone(old[i], level);</li><li>                }</li><li>                value = tmp;</li><li>            }</li><li>        }</li><li>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> Map)</li><li>        {<span class="hljs-comment">// 复制新的MAP</span></li><li>            Map tmp = (Map) c.newInstance();</li><li>            Map org = (Map) value;</li><li>            <span class="hljs-keyword">for</span> (Object key : org.keySet())</li><li>            {</li><li>                tmp.put(key, clone(org.get(key), level));<span class="hljs-comment">// 深度复制</span></li><li>            }</li><li>            value = tmp;</li><li>        }</li><li>        <span class="hljs-keyword">else</span></li><li>        {</li><li>            Object tmp = createObject(value);</li><li>            <span class="hljs-keyword">if</span> (tmp == <span class="hljs-keyword">null</span>)</li><li>            {<span class="hljs-comment">// 无法创建新实例则返回对象本身，没有克隆</span></li><li>                <span class="hljs-keyword">return</span> value;</li><li>            }</li><li>            Set&lt;Field&gt; fields = <span class="hljs-keyword">new</span> HashSet&lt;Field&gt;();</li><li>            <span class="hljs-keyword">while</span> (c != <span class="hljs-keyword">null</span> &amp;&amp; !c.equals(Object.class))</li><li>            {</li><li>                fields.addAll(Arrays.asList(c.getDeclaredFields()));</li><li>                c = c.getSuperclass();</li><li>            }</li><li>            <span class="hljs-keyword">for</span> (Field field : fields)</li><li>            {</li><li>                <span class="hljs-keyword">if</span> (!Modifier.isFinal(field.getModifiers()))</li><li>                {<span class="hljs-comment">// 仅复制非final字段</span></li><li>                    field.setAccessible(<span class="hljs-keyword">true</span>);</li><li>                    field.set(tmp, clone(field.get(value), level));<span class="hljs-comment">// 深度复制</span></li><li>                }</li><li>            }</li><li>            value = tmp;</li><li>        }</li><li>        <span class="hljs-keyword">return</span> value;</li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 浅表复制对象</li><li>     * <span class="hljs-doctag">@param</span> value 原始对象</li><li>     * <span class="hljs-doctag">@return</span> 复制后的对象，只复制一层</li><li>     * <span class="hljs-doctag">@throws</span> IllegalAccessException</li><li>     * <span class="hljs-doctag">@throws</span> InstantiationException</li><li>     * <span class="hljs-doctag">@throws</span> InvocationTargetException</li><li>     * <span class="hljs-doctag">@throws</span> NoSuchMethodException</li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">clone</span><span class="hljs-params">(Object value)</span></span></li><li>            <span class="hljs-keyword">throws</span> IllegalAccessException, InstantiationException, InvocationTargetException, NoSuchMethodException</li><li>    {</li><li>        <span class="hljs-keyword">return</span> clone(value, <span class="hljs-number">1</span>);</li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 深度复制对象</li><li>     * <span class="hljs-doctag">@param</span> value 原始对象</li><li>     * <span class="hljs-doctag">@return</span> 复制后的对象</li><li>     * <span class="hljs-doctag">@throws</span> IllegalAccessException</li><li>     * <span class="hljs-doctag">@throws</span> InstantiationException</li><li>     * <span class="hljs-doctag">@throws</span> InvocationTargetException</li><li>     * <span class="hljs-doctag">@throws</span> NoSuchMethodException</li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">deepClone</span><span class="hljs-params">(Object value)</span></span></li><li>            <span class="hljs-keyword">throws</span> IllegalAccessException, InstantiationException, InvocationTargetException, NoSuchMethodException</li><li>    {</li><li>        <span class="hljs-keyword">return</span> clone(value, -<span class="hljs-number">1</span>);</li><li>    }</li><li>}</li></ol></code></pre>
			<div><br />
			</div>
		</div>
	</body>
</html>
