<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<link rel="stylesheet" type="text/css" href="file:///${exe}/scripts/highlight.styles/${SyntaxHighlightStyleName}.css" />
		<style>
			table{border-collapse: collapse; border: 1px solid gray; border-width: 2px 1px 2px 1px;}
			th{border: 1px solid gray; padding: 4px; background-color: #ddd;}
			td{border: 1px solid gray; padding: 4px;}
			tr:nth-child(2n){background-color: #f8f8f8;}
			pre{border: 2px solid #d6d6d6; padding: 0px; border-radius: 3px;}
		</style>
	</head>
	<body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">
		<div>
			<div><br />
			</div>
			<pre>
<code id="ID_1634DDECF88" class="lang-java hljs"><ol><li><span class="hljs-keyword">package</span> com.cmcc.omc.common;</li><li></li><li><span class="hljs-keyword">import</span> java.io.BufferedInputStream;</li><li><span class="hljs-keyword">import</span> java.io.Closeable;</li><li><span class="hljs-keyword">import</span> java.io.File;</li><li><span class="hljs-keyword">import</span> java.io.FileInputStream;</li><li><span class="hljs-keyword">import</span> java.io.FileNotFoundException;</li><li><span class="hljs-keyword">import</span> java.io.FileOutputStream;</li><li><span class="hljs-keyword">import</span> java.io.IOException;</li><li><span class="hljs-keyword">import</span> java.io.InputStream;</li><li><span class="hljs-keyword">import</span> java.io.OutputStream;</li><li><span class="hljs-keyword">import</span> java.util.ArrayList;</li><li><span class="hljs-keyword">import</span> java.util.List;</li><li><span class="hljs-keyword">import</span> java.util.regex.Matcher;</li><li><span class="hljs-keyword">import</span> java.util.regex.Pattern;</li><li><span class="hljs-keyword">import</span> java.util.zip.ZipEntry;</li><li><span class="hljs-keyword">import</span> java.util.zip.ZipOutputStream;</li><li></li><li><span class="hljs-keyword">import</span> com.huawei.ibridge.framework.base.log.LogFactory;</li><li><span class="hljs-keyword">import</span> com.huawei.ibridge.framework.base.log.Logger;</li><li></li><li><span class="hljs-comment">/**</span></li><li> * </li><li> * 文件处理工具类&lt;br&gt;</li><li> */</li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileUtil</span></span></li><li>{</li><li>    <span class="hljs-comment">/** The Constant log. */</span></li><li>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LogFactory.getLogger(FileUtil.class);</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 得到当前路径下的文件列表&lt;br&gt;</li><li>     * <span class="hljs-doctag">@param</span> path 当前路径</li><li>     * <span class="hljs-doctag">@return</span> fnameList 文件列表</li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title">getFileLists</span><span class="hljs-params">(String path)</span></span></li><li>    {</li><li>        List&lt;String&gt; fnamesList = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();</li><li></li><li>        File dir = <span class="hljs-keyword">new</span> File(path);</li><li>        <span class="hljs-keyword">if</span> (dir.exists())</li><li>        {</li><li>            String[] children = dir.list();</li><li>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; children.length; i++)</li><li>            {</li><li>                String filename = children[i];</li><li>                fnamesList.add(filename);</li><li>            }</li><li>        }</li><li>        <span class="hljs-keyword">return</span> fnamesList;</li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 遍历目录及其子目录下的所有文件并保存</li><li>     * <span class="hljs-doctag">@param</span> path 目录全路径</li><li>     * <span class="hljs-doctag">@param</span> myfile 列表：保存文件对象</li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getAllFiles</span><span class="hljs-params">(File path, List&lt;File&gt; myfile)</span></span></li><li>    {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == path || !path.exists())</li><li>        {</li><li>            <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-keyword">else</span></li><li>        {</li><li>            <span class="hljs-keyword">if</span> (path.isFile())</li><li>            {</li><li>                myfile.add(path);</li><li>            }</li><li>            <span class="hljs-keyword">else</span></li><li>            {</li><li>                File[] files = path.listFiles();</li><li>                <span class="hljs-keyword">if</span> (files == <span class="hljs-keyword">null</span>)</li><li>                                {</li><li>                                        <span class="hljs-keyword">return</span>;</li><li>                                }</li><li>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; files.length; i++)</li><li>                {</li><li>                    getAllFiles(files[i], myfile);</li><li>                }</li><li>            }</li><li>        }</li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 创建文件目录&lt;br&gt;</li><li>     * <span class="hljs-doctag">@param</span> folderName 文件夹名称</li><li>     * <span class="hljs-doctag">@return</span> true, 文件目录创建成功与否</li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">createFolder</span><span class="hljs-params">(String folderName)</span></span></li><li>    {</li><li>        <span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">false</span>;</li><li>        File f = <span class="hljs-keyword">new</span> File(folderName);</li><li>        result = f.mkdirs();</li><li>        <span class="hljs-keyword">return</span> result;</li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 删除指定目录下所有文件&lt;br&gt;</li><li>     * <span class="hljs-doctag">@param</span> directory 文件目录</li><li>     * <span class="hljs-doctag">@return</span> 是否删除成功</li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">clearFolder</span><span class="hljs-params">(String directory)</span></span></li><li>    {</li><li>        <span class="hljs-comment">//null return true</span></li><li>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">null</span> == directory || directory.length() &lt; <span class="hljs-number">1</span>)</li><li>        {</li><li>            log.info(<span class="hljs-string">"directory is null or empty"</span>);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</li><li>        }</li><li>        File dir = <span class="hljs-keyword">new</span> File(directory);</li><li>        </li><li>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">null</span> == dir || !dir.exists())</li><li>        {</li><li>            log.info(<span class="hljs-string">"dir is null or not exist, directory="</span> + directory);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</li><li>        }</li><li>        </li><li>        File[] entries = dir.listFiles();</li><li>        <span class="hljs-keyword">if</span> (entries == <span class="hljs-keyword">null</span>)</li><li>        {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</li><li>                }</li><li>        <span class="hljs-keyword">boolean</span> flag = <span class="hljs-keyword">true</span>;</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; entries.length; i++)</li><li>        {</li><li>            flag = flag &amp;&amp; entries[i].delete();</li><li>        }</li><li>        <span class="hljs-keyword">return</span> flag; <span class="hljs-comment">// Static Review</span></li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * </li><li>     * 更改文件的读写执行属性&lt;br&gt;</li><li>     * <span class="hljs-doctag">@param</span> fileName 需要更改的文件名或目录</li><li>     * <span class="hljs-doctag">@param</span> executeReg 要更改的权限</li><li>     * <span class="hljs-doctag">@return</span></li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">chmod</span><span class="hljs-params">(String fileName, String executeReg)</span></span></li><li>    {</li><li>        <span class="hljs-keyword">if</span> (fileName == <span class="hljs-keyword">null</span> || <span class="hljs-string">""</span>.equals(fileName) || executeReg == <span class="hljs-keyword">null</span> || <span class="hljs-string">""</span>.equals(executeReg))</li><li>        {</li><li>            log.error(<span class="hljs-string">"chmod: the fileName is null or executeReg is null"</span>);</li><li>            <span class="hljs-keyword">return</span>;</li><li>        }</li><li></li><li>        File file = <span class="hljs-keyword">new</span> File(fileName);</li><li></li><li>        <span class="hljs-keyword">if</span> (!file.exists())</li><li>        {</li><li>            log.error(<span class="hljs-string">"chmod: the fileName is wrong,"</span> + fileName + <span class="hljs-string">"is not exists"</span>);</li><li>            <span class="hljs-keyword">return</span>;</li><li>        }</li><li></li><li>        Pattern p;</li><li>        p = Pattern.compile(<span class="hljs-string">"^[0-7]{1,3}$"</span>);</li><li></li><li>        Matcher m = p.matcher(executeReg);	</li><li>        <span class="hljs-keyword">boolean</span> rs = m.matches();</li><li>        <span class="hljs-comment">// 权限只能是r读 w写 x执行权限</span></li><li>        <span class="hljs-keyword">if</span> (!rs)</li><li>        {</li><li>            <span class="hljs-keyword">if</span> (log.isDebugEnabled())</li><li>            {</li><li>                log.debug(<span class="hljs-string">"chmod "</span> + fileName + <span class="hljs-string">" "</span> + executeReg + <span class="hljs-string">" format error."</span>);</li><li>            }</li><li>        }</li><li></li><li>        String osType = System.getProperty(<span class="hljs-string">"os.name"</span>);</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != osType)</li><li>        {</li><li>            <span class="hljs-keyword">if</span> (osType.indexOf(<span class="hljs-string">"Windows"</span>) &gt; -<span class="hljs-number">1</span> || osType.indexOf(<span class="hljs-string">"Microsoft"</span>) &gt; -<span class="hljs-number">1</span>)</li><li>            {</li><li>                <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-keyword">else</span></li><li>            {</li><li>                <span class="hljs-comment">// Solaris Linux系统需要更改权限</span></li><li>                String cmd = <span class="hljs-string">"chmod -R "</span> + executeReg + <span class="hljs-string">" "</span> + fileName;</li><li>                <span class="hljs-keyword">try</span></li><li>                {</li><li>                    log.info(<span class="hljs-string">"There is execing Runtime.getRuntime()  to Change file authority"</span>);</li><li>                    Runtime rt = Runtime.getRuntime();</li><li>                    rt.exec(cmd);</li><li>                }</li><li>                <span class="hljs-keyword">catch</span> (IOException e)</li><li>                {</li><li>                    <span class="hljs-comment">// TODO Auto-generated catch block</span></li><li>                    log.error(<span class="hljs-string">"Change file method failed. "</span> + e);</li><li>                }</li><li>            }</li><li>        }</li><li>        <span class="hljs-keyword">else</span></li><li>        {</li><li>            log.error(<span class="hljs-string">"Get os failed,please check your environment!"</span>);</li><li>        }</li><li></li><li>        <span class="hljs-keyword">if</span> (log.isDebugEnabled())</li><li>        {</li><li>            log.debug(<span class="hljs-string">"chmod "</span> + fileName + <span class="hljs-string">" "</span> + executeReg);</li><li>        }</li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 清空目录及目录下的文件</li><li>     * <span class="hljs-doctag">@param</span> dir 目录</li><li>     * <span class="hljs-doctag">@return</span></li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">deleteDir</span><span class="hljs-params">(File dir)</span></span></li><li>    {</li><li>        <span class="hljs-keyword">if</span> (dir.isDirectory())</li><li>        {</li><li>            String[] children = dir.list();</li><li>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; children.length; i++)</li><li>            {</li><li>                <span class="hljs-keyword">boolean</span> success = deleteDir(<span class="hljs-keyword">new</span> File(dir, children[i]));</li><li>                <span class="hljs-keyword">if</span> (!success)</li><li>                {</li><li>                	log.error(<span class="hljs-string">"delete file error. file is: "</span> + children[i]);</li><li>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</li><li>                }</li><li>            }</li><li>        }</li><li>        <span class="hljs-comment">// 目录此时为空，可以删除</span></li><li>        <span class="hljs-keyword">return</span> dir.delete();</li><li>    }</li><li></li><li></li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">closeStream</span><span class="hljs-params">(Closeable... streams)</span></span></li><li>    {</li><li>        <span class="hljs-keyword">for</span> (Closeable stream : streams)</li><li>        {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != stream)</li><li>            {</li><li>                <span class="hljs-keyword">try</span></li><li>                {</li><li>                    stream.close();</li><li>                }</li><li>                <span class="hljs-keyword">catch</span> (IOException e)</li><li>                {</li><li>                    stream = <span class="hljs-keyword">null</span>;</li><li>                }</li><li>            }</li><li>        }</li><li>    }</li><li></li><li>    <span class="hljs-comment">/**</span></li><li>     * 压缩文件</li><li>     * <span class="hljs-doctag">@param</span> zipFile 压缩文件名（含路径）</li><li>     * <span class="hljs-doctag">@param</span> file 待压缩文件名（含路径）</li><li>     * </li><li>     */</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zipFile</span><span class="hljs-params">(String zipFile, File file)</span></span></li><li>    {</li><li>        FileOutputStream fo = <span class="hljs-keyword">null</span>;</li><li>        ZipOutputStream zo = <span class="hljs-keyword">null</span>;</li><li>        <span class="hljs-keyword">try</span></li><li>        {</li><li>            fo = <span class="hljs-keyword">new</span> FileOutputStream(zipFile);</li><li>            zo = <span class="hljs-keyword">new</span> ZipOutputStream(fo);</li><li>            ZipEntry ze = <span class="hljs-keyword">new</span> ZipEntry(file.getName());</li><li>            ze.setTime(file.lastModified());</li><li>            zo.putNextEntry(ze);</li><li>            zipFile(zo, file);</li><li>            <span class="hljs-keyword">if</span> (!file.delete())</li><li>            {</li><li>                log.warn(<span class="hljs-string">"delete file fail, the file is : "</span> + file.getCanonicalPath());</li><li>            }</li><li>        }</li><li>        <span class="hljs-keyword">catch</span> (FileNotFoundException ex)</li><li>        {</li><li>            log.error(<span class="hljs-string">"File not found exception!"</span>, ex);</li><li>        }</li><li>        <span class="hljs-keyword">catch</span> (IOException ex)</li><li>        {</li><li>            log.error(<span class="hljs-string">"IOException!"</span>, ex);</li><li>        }</li><li>        <span class="hljs-keyword">finally</span></li><li>        {</li><li>            closeStream(zo, fo);</li><li>        }</li><li>    }</li><li></li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zipFile</span><span class="hljs-params">(OutputStream zo, File file)</span> <span class="hljs-keyword">throws</span> IOException</span></li><li>    {</li><li>        <span class="hljs-keyword">byte</span>[] buff = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];</li><li>        InputStream in = <span class="hljs-keyword">null</span>;</li><li>        BufferedInputStream bin = <span class="hljs-keyword">null</span>;</li><li>        <span class="hljs-keyword">try</span></li><li>        {</li><li>            in = <span class="hljs-keyword">new</span> FileInputStream(file);</li><li>            bin = <span class="hljs-keyword">new</span> BufferedInputStream(in);</li><li>            <span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;</li><li>            <span class="hljs-keyword">while</span> (len &gt;= <span class="hljs-number">0</span>)</li><li>            {</li><li>                len = bin.read(buff);</li><li>                <span class="hljs-keyword">if</span> (-<span class="hljs-number">1</span> != len)</li><li>                {</li><li>                    zo.write(buff, <span class="hljs-number">0</span>, len);</li><li>                }</li><li>            }</li><li>        }</li><li>        <span class="hljs-keyword">catch</span> (FileNotFoundException ex)</li><li>        {</li><li>            log.error(<span class="hljs-string">"zipFile failed, file = "</span> + file, ex);</li><li>        }</li><li>        <span class="hljs-keyword">catch</span> (IOException ex)</li><li>        {</li><li>            log.error(<span class="hljs-string">"zipFile failed, file = "</span> + file, ex);</li><li>        }</li><li>        <span class="hljs-keyword">finally</span></li><li>        {</li><li>            closeStream(bin, in);</li><li>        }</li><li>    }</li><li>}</li></ol></code></pre>
			<div><br />
			</div>
		</div>
	</body>
</html>
